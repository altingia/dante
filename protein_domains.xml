<tool id="domains_finder" name="Protein Domains Finder" version="1.0.0">
<description> Find and classify all protein domains in your DNA sequence based on the database of repetitive elements protein domains </description>
<command>
python3 ${__tool_directory__}/protein_domains_pd.py --query ${input} --domain_gff ${DomGff} --protein_database ${__tool_data_path__ }/protein_domains --classification ${__tool_data_path__ }/protein_domains --summary_file ${sum_file};

</command>
<inputs>
 <param format="fasta" type="data" name="input" label="Choose your input sequence" help="Input DNA must be in proper fasta format, multi-fasta containing more sequences is allowed" />
</inputs>

<outputs>
 <data format="gff3" name="DomGff" label="GFF3 file of all protein domains from dataset ${input.hid}" />
 <data format="txt" name="sum_file" label="Summary amounts of domains from dataset ${input.hid}" />
</outputs>

 <help>

**WHAT IT DOES**

This tool uses external aligning programme `LAST`_ and **RepeatExplorer database of Viridiplantae TE protein domains (! in case of non-Viridiplantae species classification might not be reliable !)** 

.. _LAST: http://last.cbrc.jp/  

*Lastal* runs similarity search to find hits between query DNA sequence and our database of protein domains from all Viridiplantae repetitive elements. Hits with overlapping positions in the sequence (even through other hits) forms a cluster which represents one potential protein domain. Strand orientation is taken into consideration when forming the clusters which means each cluster is built from forward or reverse stranded hits exclusively. The clusters are subsequently processed separately; within one cluster positions are scanned base-by-base and classification strings are assigned for each of them based on the database sequences which were mapped on that place. These asigned classification strings consist of a domain type as well as class and lineage of the repetitive element where the database protein comes from. Different classification levels are separated by "|" character. Every hit is scored according to the scoring matrix used for DNA-protein alignment (BLOSUM80). For single position only the hits reaching certain percentage (80% by default) of the overall best score within the whole cluster are reported. One cluster of overlapping hits represents one domain region and is recorded as one line in the resulting GFF3 file. Regarding the classition strings assigned to one region (cluster) there are three situations that can occur:

	1. There is a single classification string assigned to each position as well as classifications along all the positions in the region are mutually uniform, in this case domain's final classification is equivalent to this unique classification.
	2. There are multiple classification strings assigned to one cluster, i.e. one domain, which leads to classification to the common (less specific) level of all the strings
	3. There is a conflict at the domain type level, domains are reported with slash (e.g. RT/INT) and the classification is in this case ambiguous
	
**There are 2 outputs produced by this tool:**
	
1. GFF3 file of all proteins domains built from all hits found by LAST. Potential domains are reported per line as regions (start - end) on the original DNA sequence including the seq ID, alignment score and strand orientation. The last "Attributes" column contains several semicolon-separated information related to annotation, repetitive classification, alignment and its quality. This file can undergo further filtering using *Protein Domain Filter* tool

- Attributes reported always:

	Name
		type of domain; if ambiguous reported with slash 
		
	Final_classification 
		definite classification based on all partial classifications of Region_hits_classifications attribute or 
		"Ambiguous_domain" when there is an ambiguous domain type 
		
	Region_hits_classifications
		all hits classifications (comma separated) from a certain domain region that reach the set score threshold; in case of multiple annotations the square brackets indicate the number of bases having this particular classification		
			
- Attributes only reported in case of distinct domain type (all the attributes including quality information, which allows further filtering, are related to the Best_Hit of the region):
	
	Best_hit  
		classification and position of the best alignment with the highest score within the cluster; in the square brackets is the percentage of the whole cluster range that this best hit covers
		
	DB_Seq 
		database protein sequence of the best hit mapped to the query DNA
		
	Query_Seq 
		alignment sequence of the query DNA for the best hit	
		
	Identity
		ratio of identical amino acids in alignment sequence to the length of alignment
		
	Similarity
		ratio of alignment positions with positive score (according to the scoring matrix) to the length of alignment
		
	Relat_Length
		ratio of gapless length of the aligned protein sequence to the whole length of the database protein 
		
	Relat_interruptions
		number of the interruptions (frameshifts + stop codons) in aligned translated query sequence per each starting 100 AA

2. summary text file with overview of amounts of domains types in individual sequences

!NOTE: Tool can in average process 0.5 Gbps of the DNA sequence per day. This is only a rough estimate and it is highly dependent on input data (repetive elements occurence) as well as computing resources. Maximum running time of the tool is 7 days.

 </help>
</tool>

